## template: jinja
#cloud-config
# yamllint disable rule:document-start rule:line-length
write_files:
  - path: /var/lib/webapp/html/index.html
    permissions: '0644'
    owner: root
    content: |
      ${index_html}
  - path: /var/lib/webapp/html/styles.css
    permissions: '0644'
    owner: root
    encoding: gz+b64
    content: |
      ${styles_css}
  - path: /var/lib/webapp/html/f5-logo-rgb.svg
    permissions: '0644'
    owner: root
    encoding: gz+b64
    content: |
      ${f5_logo_rgb_svg}
  - path: /var/lib/webapp/conf.d/default.conf
    permissions: '0644'
    owner: root
    content: |
      server {
        listen 80 default_server;
        server_name _;
        location / {
          root /usr/share/nginx/html;
          index index.html;
        }
      }

runcmd:
  - apt-get update
  - apt-get install -y software-properties-common
  - apt-get install -y apt-transport-https ca-certificates curl gnupg-agent software-properties-common
  - curl -fsSL https://get.docker.com -o get-docker.sh
  - sh get-docker.sh
  - while ! docker --version; do echo trying again&sleep 1; done
  - docker run --rm --name webapp -p 80:80 -v /var/lib/webapp/html:/usr/share/nginx/html:ro -v /var/lib/webapp/conf.d:/etc/nginx/conf.d:ro nginx:alpine
